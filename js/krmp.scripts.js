$(function(){processView.init();});
function aab(){$("#___gcse_0").length?($(".gsib_a").css("padding","0px"),$('input[placeholder="Custom Search"]').attr("placeholder","KRMP Search").parent().css("padding","0px").removeClass("gsib_a"),$("input.gsc-search-button").val("Search").css({height:"auto",width:"auto"})):setTimeout("aab()",1e3)}$(function(){processView.init()});var processView={reqSongId:"",reqUrl:"",audioCtx:null,songSrc:new Array,songbuffer:null,playSong:{title:"",mp3:"",poster:""},songLength:0,totalDuration:0,timeoutFunc:"",init:function(){var e=document.createElement("script");e.innerHTML="$('a').click(function(e){e.preventDefault();processView.getView(this.href);});",document.body.appendChild(e),aab();var t=$("requesteduri").html();t.length>0&&alert(t),processView.resetAdBlock()},getSongUrl:function(e){processView.reqSongId=e,processView.songSrc[processView.reqSongId]=[],processView.songLength=0,processView.totalDuration=0,clearTimeout(processView.timeoutFunc),e&&$.ajax({url:"http://"+document.domain+"/index.php/songs/s_home/play/"+e,cache:"true",type:"GET",dataType:"JSON",beforeSend:function(){if(void 0===$("script#notifyJs").attr("src")){var e=document.createElement("script");e.id="notifyJs",e.src="//"+document.domain+"/js/notify.min.js",document.body.appendChild(e)}$("#togglePlayerBtn").fadeIn(1e3).html("").css("background","url(/images/mloading.gif) no-repeat center center").css("background-size","cover")},success:function(e,t,s){(s.state="success"==t)&&processView.actionPlayer(e.a,e.b,e.c,e.d,processView.reqSongId)},error:function(e,t,s){console.log(s)}})},actionPlayer:function(e,t,s,o,a){processView.playSong.title=s.toUpperCase().replace(/ /g,"_"),processView.playSong.mp3=atob(e),processView.playSong.poster="http://"+document.domain+"/images/albums/"+o+"/a_art.jpg";$.ajax({url:e&&t?"http://"+document.domain+"/index.php/songs/s_home/play/song/"+t:"",cache:"true",type:"POST",data:{secKey:t},dataType:"JSON",success:function(e,t){1==e.status&&"success"==t?(processView.audioCtx&&processView.audioCtx.close(),processView.audioCtx=new(window.AudioContext||window.webkitAudioContext),processView.audioCtx.onstatechange=processView.playerHandler(),processView.updateSongBuffer()):alert("actionPlayer failed after ajax call")}})},updateSongBuffer:function(){var e=new XMLHttpRequest;processView.songLength++,e.open("GET",processView.playSong.mp3+"/"+processView.songLength,!0),e.responseType="arraybuffer",e.onprogress=function(){$("#togglePlayerBtn").css("background","url(/images/mloading.gif) no-repeat center center").css("background-size","cover")},e.onload=function(t){$("#togglePlayerBtn").css("background","transparent");var s=e.response,o=processView.audioCtx.createBufferSource();processView.audioCtx.decodeAudioData(s).then(function(e){o.buffer=e,processView.songSrc[processView.reqSongId][processView.songLength]=o,processView.songSrc[processView.reqSongId][processView.songLength].connect(processView.audioCtx.destination),processView.songSrc[processView.reqSongId].length>2?processView.totalDuration+=processView.songSrc[processView.reqSongId][processView.songLength-1].buffer.duration-.025:processView.totalDuration+=processView.audioCtx.currentTime,processView.songSrc[processView.reqSongId][processView.songLength].start(processView.totalDuration),processView.timeoutFunc=setTimeout("processView.updateSongBuffer()",2e3)},function(e){})},e.send()},playerHandler:function(){lg(processView.audioCtx.state),"playing"==$("#togglePlayerBtn").attr("state")?("running"==processView.audioCtx.state&&processView.audioCtx.suspend(),$("#togglePlayerBtn").attr("state","suspended"),$("#togglePlayerBtn").html('<span class="fa fa-play" aria-hidden="true"></span>')):"suspended"==$("#togglePlayerBtn").attr("state")?(processView.audioCtx.resume(processView.audioCtx.currentTime),$("#togglePlayerBtn").attr("state","playing"),$("#togglePlayerBtn").html('<span class="fa fa-pause" aria-hidden="true"></span>')):"idle"==$("#togglePlayerBtn").attr("state")?"suspended"==processView.audioCtx.state?(processView.audioCtx.resume(processView.audioCtx.currentTime),$("#togglePlayerBtn").attr("state","playing"),$("#togglePlayerBtn").html('<span class="fa fa-pause" aria-hidden="true"></span>')):"closed"==processView.audioCtx.state&&($("#togglePlayerBtn").attr("state","idle"),$("#togglePlayerBtn").html('<span class="fa fa-play" aria-hidden="true"></span>'),processView.getSongUrl(processView.reqSongId)):$("#togglePlayerBtn").attr("state","playing").html('<span class="fa fa-pause" aria-hidden="true"></span>')},getView:function(e){e.toString().split("/").length>4&&$.ajax({url:e,cache:"false",type:"GET",dataType:"JSON",success:function(t,s,o){200==o.status&&"success"==s&&(document.title=t.pageTitle,history.pushState({urlPath:e.href},"",e.href),$("#container").html(t.resHtml),$(window).bind("popstate",function(t){t.preventDefault(),history.replaceState({urlPath:e.href},"",e.href)}),$("#container a").click(function(e){e.preventDefault(),processView.getView(this)}))},error:function(e,t,s){console.log(s)}})}};function lg(e){console.log(e)}